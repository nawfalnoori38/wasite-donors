<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ุณุฌู ูุชุจุฑุนูู ูุญุงูุธุฉ ูุงุณุท</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#b71c1c">

<style>
body{
  font-family: Arial;
  background:#f5f5f5;
  padding:20px
}
h2{color:#b71c1c}
.box{
  background:#fff;
  padding:20px;
  border-radius:12px;
  max-width:420px;
  margin:auto;
  box-shadow:0 10px 25px rgba(0,0,0,.15)
}
label{margin-top:10px;display:block}
input,select{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
  margin-top:5px
}
button{
  margin-top:15px;
  width:100%;
  padding:12px;
  background:#b71c1c;
  color:#fff;
  border:0;
  border-radius:10px;
  cursor:pointer
}
.card{
  border:1px solid #ddd;
  padding:10px;
  margin-top:8px;
  border-radius:6px
}
</style>
</head>

<body>

<!-- ุดุงุดุฉ ุงูุฏุฎูู -->
<div id="loginBox" style="position:fixed;inset:0;background:#f5f5f5;display:flex;align-items:center;justify-content:center;z-index:9999">
  <div class="box">
    <h3 style="color:#b71c1c">ุงูุฏุฎูู</h3>
    <input type="password" id="pagePassword" placeholder="ูููุฉ ุงููุฑูุฑ">
    <button onclick="checkPagePassword()">ุฏุฎูู</button>
    <p id="loginMsg" style="color:red"></p>
  </div>
</div>

<div id="mainContent" style="display:none">

<div style="text-align:center;margin-bottom:20px">
  <img src="wasit-logo.jpg" style="width:110px;border-radius:50%">
  <h2>ุณุฌู ูุชุจุฑุนูู ูุญุงูุธุฉ ูุงุณุท</h2>
</div>

<div class="box">
<h3>ุชุณุฌูู ูุชุจุฑุน</h3>

<label>ุงูุงุณู ุงููุงูู *</label>
<input id="name">

<label>ุฑูู ุงููุงุชู *</label>
<input id="phone">

<label>ูุตููุฉ ุงูุฏู *</label>
<select id="blood">
<option value="">ุงุฎุชุฑ</option>
<option>A+</option><option>A-</option>
<option>B+</option><option>B-</option>
<option>AB+</option><option>AB-</option>
<option>O+</option><option>O-</option>
</select>
<label>ูุฑูุฒ ุงูุชุจุฑุน</label>
<select id="bloodCenter">
  <option value="">ุงุฎุชุฑ ูุฑูุฒ ุงูุชุจุฑุน</option>
  <option>ูุฑูุฒ ุชุจุฑุน ุงูููุช</option>
  <option>ูุฑูุฒ ุชุจุฑุน ุงูุญู</option>
  <option>ูุฑูุฒ ุชุจุฑุน ุงููุนูุงููุฉ</option>
  <option>ูุฑูุฒ ุชุจุฑุน ุงูุนุฒูุฒูุฉ</option>
  <option>ูุฑูุฒ ุชุจุฑุน ุงูุตููุฑุฉ</option>
</select>

<label>ุงูููุทูุฉ</label>
<input id="area">

<label>ุชุงุฑูุฎ ุขุฎุฑ ุชุจุฑุน</label>
<input type="date" id="last">

<button onclick="saveDonor()">ุชุณุฌูู</button>
<p id="msg"></p>

<hr>

<button onclick="toggleSearch()">๐ ุงูุจุญุซ ุนู ูุชุจุฑุนูู</button>
<div id="searchBox" style="display:none">
  <input id="searchName" placeholder="ุงูุงุณู ุฃู ูุตููุฉ ุงูุฏู (A+, O- ...)">
  <button onclick="searchDonors()">ุจุญุซ</button>
  <div id="results"></div>
</div>

<hr>

<button style="background:#1565c0" onclick="openLab()">๐งช ุฏุฎูู ุงููุฎุชุจุฑ</button>

<div id="labBox" style="display:none">

<label>ูููุฉ ูุฑูุฑ ุงููุฎุชุจุฑ</label>
<input type="password" id="labPassword">
<button onclick="loginLab()">ุฏุฎูู</button>

<div id="labForm" style="display:none">

<label>ุงุณู ุงููุชุจุฑุน (ููุง ูู ุงูุณุฌู)</label>
<input id="labName">

<label>HIV</label>
<select id="HIV"><option>ุบูุฑ ููุญูุต</option><option>ุณูุจู</option><option>ุฅูุฌุงุจู</option></select>

<label>HCV</label>
<select id="HCV"><option>ุบูุฑ ููุญูุต</option><option>ุณูุจู</option><option>ุฅูุฌุงุจู</option></select>

<label>TPHA</label>
<select id="TPHA"><option>ุบูุฑ ููุญูุต</option><option>ุณูุจู</option><option>ุฅูุฌุงุจู</option></select>

<label>HBsAg</label>
<select id="HBsAg"><option>ุบูุฑ ููุญูุต</option><option>ุณูุจู</option><option>ุฅูุฌุงุจู</option></select>

<label>HBcAb</label>
<select id="HBcAb"><option>ุบูุฑ ููุญูุต</option><option>ุณูุจู</option><option>ุฅูุฌุงุจู</option></select>

<label>ููุงุญุธุงุช ุงููุฎุชุจุฑ</label>
<input id="labNotes">

<button onclick="saveLab()">๐พ ุญูุธ ุงููุญูุตุงุช</button>
<p id="labMsg"></p>

</div>
</div>

</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxXhxFJ83eC03Zy6AgwQkM72BI-lQy5RB75n8pKhUx6riMH3RCH_H8SiF1JeF50m9cNHw/exec";
const PAGE_PASSWORD="khnzs";
const LAB_PASSWORD="lab123";

function checkPagePassword(){

  const input = document.getElementById("pagePassword").value.trim();
  const loginBox = document.getElementById("loginBox");
  const mainContent = document.getElementById("mainContent");
  const msg = document.getElementById("loginMsg");

  if(input === ""){
    msg.innerText = "โ๏ธ ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ";
    return;
  }

  if(input !== PAGE_PASSWORD){
    msg.innerText = "โ ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ";
    return;
  }

  // ูุฌุงุญ ุงูุฏุฎูู
  loginBox.style.display = "none";
  mainContent.style.display = "block";
}


async function saveDonor(){

  const nameVal   = document.getElementById("name").value.trim();
  const phoneVal  = document.getElementById("phone").value.trim();
  const bloodVal  = document.getElementById("blood").value;
  const centerVal = document.getElementById("bloodCenter").value;
  const areaVal   = document.getElementById("area").value.trim();
  const lastVal   = document.getElementById("last").value;

  if(!nameVal || !phoneVal || !bloodVal || !centerVal){
    document.getElementById("msg").innerText =
      "โ ูุฑุฌู ููุก ุงูุญููู ุงููุทููุจุฉ";
    return;
  }

  const data = {
    "ุงูุงุณู": nameVal,
    "ุฑูู ุงููุงุชู": phoneVal,
    "ูุตููุฉ ุงูุฏู": bloodVal,
    "ูุฑูุฒ ุงูุชุจุฑุน": centerVal,
    "ุงูููุทูุฉ": areaVal,
    "ุขุฎุฑ ุชุจุฑุน": lastVal
  };

  await fetch(API_URL,{
    method: "POST",
    body: JSON.stringify(data)
  });

  document.getElementById("msg").innerText =
    "โ ุชู ุงูุชุณุฌูู ุจูุฌุงุญ";

  // ุชูุฑูุบ ุงูุญููู
  document.getElementById("name").value = "";
  document.getElementById("phone").value = "";
  document.getElementById("blood").selectedIndex = 0;
  document.getElementById("bloodCenter").selectedIndex = 0;
  document.getElementById("area").value = "";
  document.getElementById("last").value = "";
}



function toggleSearch(){
  searchBox.style.display=searchBox.style.display==="none"?"block":"none";
}
async function searchDonors(){

  const res = await fetch(API_URL);
  const data = await res.json();
  results.innerHTML = "";

  const query = document
    .getElementById("searchName")
    .value
    .trim()
    .toUpperCase();

  let found = false;

  data.forEach(d => {

    const name  = (d["ุงูุงุณู"] || "").toUpperCase();
    const blood = (d["ูุตููุฉ ุงูุฏู"] || "").toUpperCase();

    if(query && (name.includes(query) || blood === query)){
      found = true;

      const phone = d["ุฑูู ุงููุงุชู"] || "";

      let statusColor = "#555";
      if(d["ุญุงูุฉ ุงูุชุจุฑุน"]?.includes("ุตุงูุญ")) statusColor = "#2e7d32";
      if(d["ุญุงูุฉ ุงูุชุจุฑุน"]?.includes("ุบูุฑ ุตุงูุญ")) statusColor = "#c62828";
      if(d["ุญุงูุฉ ุงูุชุจุฑุน"]?.includes("ููุฏ")) statusColor = "#f9a825";

      results.innerHTML += `
        <div class="card">

          <strong>${d["ุงูุงุณู"]}</strong><br>
          ๐ฉธ <b>ุงููุตููุฉ:</b> ${d["ูุตููุฉ ุงูุฏู"] || "-"}<br>
          ๐ฅ ๐ฅ <b>ูุฑูุฒ ุงูุชุจุฑุน:</b> ${d["ูุฑูุฒ ุงูุชุจุฑุน"] || "-"}<br>
          ๐ <b>ุงูููุทูุฉ:</b> ${d["ุงูููุทูุฉ"] || "-"}<br>
          ๐ <b>ุงููุงุชู:</b> ${phone}<br>
          ๐ <b>ุขุฎุฑ ุชุจุฑุน:</b> ${formatDate(d["ุขุฎุฑ ุชุจุฑุน"])}<br>
          ๐๏ธ <b>ุชุงุฑูุฎ ุงูุชุณุฌูู:</b> ${formatDate(d["ุชุงุฑูุฎ ุงูุชุณุฌูู"])}<br>

          <hr>

          ๐งช <b>ุงููุญูุตุงุช ุงููุฎุชุจุฑูุฉ</b><br>
          HIV: ${d["HIV"] || "-"} |
          HCV: ${d["HCV"] || "-"} |
          TPHA: ${d["TPHA"] || "-"}<br>
          HBsAg: ${d["HBsAg"] || "-"} |
          HBcAb: ${d["HBcAb"] || "-"}<br>

          ๐ <b>ููุงุญุธุงุช:</b> ${d["ููุงุญุธุงุช ุงููุฎุชุจุฑ"] || "ูุง ุชูุฌุฏ"}<br>
          ๐งช <b>ุชุงุฑูุฎ ุงููุญุต:</b> ${formatDate(d["ุชุงุฑูุฎ ุงููุญุต"])}<br>

          โ๏ธ <b>ุงูุญุงูุฉ:</b>
          <span style="color:${statusColor};font-weight:bold">
            ${d["ุญุงูุฉ ุงูุชุจุฑุน"] || "-"}
          </span>

          <br><br>

          <a href="tel:${phone}"
             style="background:#2e7d32;color:#fff;padding:6px 10px;border-radius:4px;text-decoration:none">
            ๐ ุงุชุตุงู
          </a>

          <a href="https://wa.me/${phone}" target="_blank"
             style="background:#25D366;color:#fff;padding:6px 10px;border-radius:4px;text-decoration:none;margin-right:6px">
            ๐ฌ ูุงุชุณุงุจ
          </a>

          <br><br>

          <!-- ุชุนุฏูู ุจูุงูุงุช ุงููุชุจุฑุน -->
          <button
  onclick="openEdit(
    '${d["ุงูุงุณู"]}',
    '${phone}',
    '${d["ูุตููุฉ ุงูุฏู"]}',
    '${d["ูุฑูุฒ ุงูุชุจุฑุน"]}',
    '${d["ุงูููุทูุฉ"]}',
    '${d["ุขุฎุฑ ุชุจุฑุน"] || ""}'
  )"
  style="background:#1565c0;color:#fff;border:0;padding:6px 10px;border-radius:4px">
  โ๏ธ ุชุนุฏูู ุจูุงูุงุช ุงููุชุจุฑุน
</button>

          <br><br>

          <!-- ุชุนุฏูู ูุชุงุฆุฌ ุงููุฎุชุจุฑ -->
          <button
            onclick="openLabEdit(
              '${d["ุงูุงุณู"]}',
              '${d["HIV"] || ""}',
              '${d["HCV"] || ""}',
              '${d["TPHA"] || ""}',
              '${d["HBsAg"] || ""}',
              '${d["HBcAb"] || ""}',
              '${d["ููุงุญุธุงุช ุงููุฎุชุจุฑ"] || ""}'
            )"
            style="background:#6a1b9a;color:#fff;border:0;padding:6px 10px;border-radius:4px">
            ๐งช ุชุนุฏูู ูุชุงุฆุฌ ุงููุฎุชุจุฑ
          </button>

        </div>
      `;
    }
  });

  if(!found){
    results.innerHTML = "โ ูุง ุชูุฌุฏ ูุชุงุฆุฌ ูุทุงุจูุฉ";
  }
}

function openLab(){labBox.style.display="block";}
function loginLab(){
  if(labPassword.value!==LAB_PASSWORD){alert("โ ุฎุทุฃ");return;}
  labForm.style.display="block";
}

async function saveLab(){
  await fetch(API_URL,{method:"POST",body:JSON.stringify({
    "ุงูุงุณู":labName.value.trim(),
    "HIV":HIV.value,
    "HCV":HCV.value,
    "TPHA":TPHA.value,
    "HBsAg":HBsAg.value,
    "HBcAb":HBcAb.value,
    "ููุงุญุธุงุช ุงููุฎุชุจุฑ":labNotes.value
  })});
  labMsg.innerText="โ ุชู ุญูุธ ูุชุงุฆุฌ ุงููุฎุชุจุฑ";
}
function openEdit(name, phone, blood, center, area, last){
  editBox.style.display = "flex";
  editName.value   = name;
  editPhone.value  = phone;
  editBlood.value  = blood;
  editCenter.value = center;
  editArea.value   = area;
  editLast.value   = last || "";
}

function closeEdit(){
  editBox.style.display = "none";
}

async function saveEdit(){
  const data = {
    "ุงูุงุณู": editName.value,
    "ุฑูู ุงููุงุชู": editPhone.value,
    "ูุตููุฉ ุงูุฏู": editBlood.value,
    "ูุฑูุฒ ุงูุชุจุฑุน": editCenter.value,
    "ุงูููุทูุฉ": editArea.value,
    "ุขุฎุฑ ุชุจุฑุน": editLast.value,
    "ุชุนุฏูู": true
  };

  await fetch(API_URL,{
    method:"POST",
    body:JSON.stringify(data)
  });

  editMsg.innerText = "โ ุชู ุชุญุฏูุซ ุงูุจูุงูุงุช ุจูุฌุงุญ";
}
function openLabEdit(name, hiv, hcv, tpha, hbs, hbc, notes){
  labEditBox.style.display = "flex";

  editLabName.value = name;
  editHIV.value     = hiv || "ุบูุฑ ููุญูุต";
  editHCV.value     = hcv || "ุบูุฑ ููุญูุต";
  editTPHA.value    = tpha || "ุบูุฑ ููุญูุต";
  editHBsAg.value   = hbs || "ุบูุฑ ููุญูุต";
  editHBcAb.value   = hbc || "ุบูุฑ ููุญูุต";
  editLabNotes.value= notes || "";
}

function closeLabEdit(){
  labEditBox.style.display = "none";
}

async function saveLabEdit(){
  const body = {
    "ุงูุงุณู": editLabName.value,
    "HIV": editHIV.value,
    "HCV": editHCV.value,
    "TPHA": editTPHA.value,
    "HBsAg": editHBsAg.value,
    "HBcAb": editHBcAb.value,
    "ููุงุญุธุงุช ุงููุฎุชุจุฑ": editLabNotes.value
  };

  await fetch(API_URL,{
    method:"POST",
    body: JSON.stringify(body)
  });

  labEditMsg.innerText = "โ ุชู ุชุญุฏูุซ ูุชุงุฆุฌ ุงููุฎุชุจุฑ";
}
function formatDate(dateStr){
  if(!dateStr) return "-";

  const d = new Date(dateStr);

  return d.toLocaleString("ar-IQ", {
    timeZone: "Asia/Baghdad",
    weekday: "long",
    year: "numeric",
    month: "2-digit",
    day: "2-digit",
    hour: "2-digit",
    minute: "2-digit"
  });
}
</script>
<!-- ูุงูุฐุฉ ุชุนุฏูู ุงููุชุจุฑุน -->
<div id="editBox" style="
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  align-items:center;
  justify-content:center;
  z-index:9999
">
  <div class="box">
    <h3>โ๏ธ ุชุนุฏูู ุจูุงูุงุช ุงููุชุจุฑุน</h3>

    <input type="hidden" id="editName">

    <label>ุฑูู ุงููุงุชู</label>
    <input id="editPhone">

    <label>ูุตููุฉ ุงูุฏู</label>
    <select id="editBlood">
      <option>A+</option><option>A-</option>
      <option>B+</option><option>B-</option>
      <option>AB+</option><option>AB-</option>
      <option>O+</option><option>O-</option>
    </select>

    <label>ูุตุฑู ุงูุฏู</label>
    <select id="editCenter">
      <option>ูุตุฑู ุฏู ุงูููุช</option>
      <option>ูุตุฑู ุฏู ุงูุญู</option>
      <option>ูุตุฑู ุฏู ุงููุนูุงููุฉ</option>
      <option>ูุตุฑู ุฏู ุงูุนุฒูุฒูุฉ</option>
      <option>ูุตุฑู ุฏู ุงูุตููุฑุฉ</option>
    </select>

    <label>ุงูููุทูุฉ</label>
    <input id="editArea">

    <label>ุขุฎุฑ ุชุจุฑุน</label>
    <input type="date" id="editLast">

    <button onclick="saveEdit()">๐พ ุญูุธ ุงูุชุนุฏูู</button>
    <button onclick="closeEdit()" style="background:#777">ุฅูุบุงุก</button>

    <p id="editMsg"></p>
  </div>
</div>

<footer style="margin-top:40px;text-align:center;color:#555">
ยฉ 2026 โ NAWFAL NOORI
</footer>
<div id="labEditBox" style="
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  align-items:center;
  justify-content:center;
  z-index:9999
">
  <div class="box">
    <h3>๐งช ุชุนุฏูู ูุชุงุฆุฌ ุงููุฎุชุจุฑ</h3>

    <input type="hidden" id="editLabName">

    <label>HIV</label>
    <select id="editHIV">
      <option>ุบูุฑ ููุญูุต</option>
      <option>ุณูุจู</option>
      <option>ุฅูุฌุงุจู</option>
    </select>

    <label>HCV</label>
    <select id="editHCV">
      <option>ุบูุฑ ููุญูุต</option>
      <option>ุณูุจู</option>
      <option>ุฅูุฌุงุจู</option>
    </select>

    <label>TPHA</label>
    <select id="editTPHA">
      <option>ุบูุฑ ููุญูุต</option>
      <option>ุณูุจู</option>
      <option>ุฅูุฌุงุจู</option>
    </select>

    <label>HBsAg</label>
    <select id="editHBsAg">
      <option>ุบูุฑ ููุญูุต</option>
      <option>ุณูุจู</option>
      <option>ุฅูุฌุงุจู</option>
    </select>

    <label>HBcAb</label>
    <select id="editHBcAb">
      <option>ุบูุฑ ููุญูุต</option>
      <option>ุณูุจู</option>
      <option>ุฅูุฌุงุจู</option>
    </select>

    <label>ููุงุญุธุงุช ุงููุฎุชุจุฑ</label>
    <input id="editLabNotes">

    <button onclick="saveLabEdit()">๐พ ุญูุธ ุงูุชุนุฏูู</button>
    <button onclick="closeLabEdit()" style="background:#777">ุฅูุบุงุก</button>

    <p id="labEditMsg"></p>
  </div>
</div>

</body>
</html>

